# Next.JS Quickstart

Welcome to the Next.js quickstart guide! In this document, you will learn to build a Next.js app, add user login and display user profile information using {{ product_name }}.

[//] STEPS_START

## Configure an Application in {{ product_name }}

- Sign into the {{ product_name }} Console and navigate to **Applications > New Application.**
- Select **Next.js** and complete the wizard by providing a suitable name and an authorized redirect URL.

!!! Example
    **Name:** `{{ product }}-nextjs`

    **Authorized redirect URL:** `http://localhost:3000`

Once you finish creating the application, note down the following values from its **Guide** tab. You will need them to configure Asgardeo Next.js SDK.

- **Client ID** - The unique identifier for your application.
- **Client Secret** - The secret key generated for your application.
- **Base URL** - The base URL of your {{ product_name }} organization. This typically follows the format `{{content.sdkconfig.baseUrl}}`

!!! Info

    The authorized redirect URL specifies where {{product_name}} should send users after they successfully log in. This is usually the web address where your application is running. For this guide, we'll use `http://localhost:3000`, as the sample app will be accessible at this URL.

## Create a Next.js app

Create your new Next.js app.

=== "npm"

    ``` bash
    npm create next-app@latest {{ product }}-nextjs -- --yes
    cd {{ product }}-nextjs
    npm run dev
    ```

=== "yarn"

    ``` bash
    yarn create next-app@latest {{ product }}-nextjs -- --yes
    cd {{ product }}-nextjs
    yarn dev
    ```

=== "pnpm"

    ``` bash
    pnpm create next-app@latest {{ product }}-nextjs -- --yes
    cd {{ product }}-nextjs
    pnpm dev
    ```

## Install `@asgardeo/nextjs`

Asgardeo Next.js SDK provides all the components and hooks you need to integrate {{ product_name }} into your app. To get started, simply add the Asgardeo Next.js SDK to the project. Make sure to stop the dev server started in the previous step.

=== "npm"

    ``` bash
    npm install @asgardeo/nextjs
    ```

=== "yarn"

    ``` bash
    yarn add @asgardeo/nextjs
    ```

=== "pnpm"

    ``` bash
    pnpm add @asgardeo/nextjs
    ```

## Set up environment variables

Create a `.env` or an appropriate environment configuration file in the root of your Next.js project. This file will store all the configuration values required for the Asgardeo Next.js SDK to function properly.

```bash title=".env"
NEXT_PUBLIC_ASGARDEO_BASE_URL="{{content.sdkconfig.baseUrl}}"
NEXT_PUBLIC_ASGARDEO_CLIENT_ID="<your-app-client-id>"
ASGARDEO_CLIENT_SECRET="<your-app-client-secret>"
```

{% if product_name == "WSO2 Identity Server" %}
!!! Note
    If you are running in a local development or testing environment using self-signed SSL certificates, your application may fail to connect due to TLS certificate validation errors. To bypass this check add `NODE_TLS_REJECT_UNAUTHORIZED=0` to the `.env` file.
{% endif %}


## Setup the middleware

Create a file called `middleware.ts` in the root of your Next.js project and integrate the `asgardeoMiddleware` from the Asgardeo Next.js SDK.

The `asgardeoMiddleware` helper integrates Asgardeo authentication into your Next.js application and supports both the App and Pages routers.

```bash title="middleware.ts"
import {asgardeoMiddleware} from '@asgardeo/nextjs/server';

export default asgardeoMiddleware();

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
};
```

## Add `<AsgardeoProvider />` to your app

The `<AsgardeoProvider />` serves as a context provider for the SDK. You can integrate this provider to your app by wrapping the root component.

Add the following changes to the `app/layout.tsx` file in your Next.js project.

```javascript title="app/layout.tsx" hl_lines="3 31"
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import {AsgardeoProvider} from '@asgardeo/nextjs/server';
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <AsgardeoProvider>{children}</AsgardeoProvider>
      </body>
    </html>
  );
}
```

## Add sign-in and sign-out to your app

Asgardeo SDK provides `SignInButton`, `SignOutButton` components to handle user sign-in and sign-out. You can use these components along side `SignedIn` and `SignedOut` components to conditionally render content based on the user's logged in state.

Replace the existing content of the `app/page.tsx` file with following content.

```javascript title="app/page.tsx"  hl_lines="1 6-11"
import {SignInButton, SignedIn, SignOutButton, SignedOut} from '@asgardeo/nextjs';

export default function Home() {
  return (
    <header>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <SignOutButton />
      </SignedIn>
    </header>
  );
}
```

## Display signed-in user's profile information

The SDK provides several ways to access the signed-in user's profile information. You can use the `User`, `UserProfile`, or `UserDropdown` components to access and display user profile information in a declarative way.

- `User`: The `User` component provides a render prop pattern to access user profile information:
- `UserProfile`: The `UserProfile` component provides a declarative way to display and update user profile information.
- `UserDropdown`: The `UserDropdown` component provides a dropdown menu with built-in user information and sign-out functionality.

```javascript title="app/page.tsx" hl_lines="1 8 17-24"
'use client'

import { SignedIn, SignedOut, SignInButton, SignOutButton, User, UserDropdown, UserProfile } from '@asgardeo/nextjs';

export default function Home() {
  return (
    <>
      <header>
        <SignedIn>
          <UserDropdown />
          <SignOutButton />
        </SignedIn>
        <SignedOut>
          <SignInButton />
        </SignedOut>
      </header>
      <main>
        <SignedIn>
          <User>
            {(user) => (
              <div>
                <p>Welcome back, {user.userName || user.username || user.sub}</p>
              </div>
            )}
          </User>
          <UserProfile />
        </SignedIn>
      </main>
    </>
  );
}
```

## Choose how users will sign in

Before running the app, you need to decide how you want users to sign into your application:

<div class="mode-selection-container" data-selection-group="quickstart">
  <button class="md-typeset md-button mode-selection-btn active" data-quickstart="redirect" data-next-step="8" data-default="true">
    <input type="radio" name="quickstart-mode" class="mode-radio" data-selection-radio checked>
    <span class="radio-circle"></span>
    Redirect to {{ product_name }} (Default)
  </button>
  <button class="md-typeset md-button mode-selection-btn" data-quickstart="embedded" data-next-step="8">
    <input type="radio" name="quickstart-mode" class="mode-radio" data-selection-radio>
    <span class="radio-circle"></span>
    Show sign-in form in your app
  </button>
</div>

<div class="mode-content" data-content-for="quickstart" data-content-value="redirect">

When users click `Sign In`, your app redirects them to {{ product_name }}'s sign-in page. After they sign in, it redirects them back to your app. This default behavior works without extra configurations.

</div>

<div class="mode-content" data-content-for="quickstart" data-content-value="embedded" style="display: none;">

The sign-in form appears directly inside your application using the `SignIn` component. Users never leave your app during the sign-in process.

</div>

## Enable `App-Native Authentication` [//] SHOW_IF="data-quickstart=embedded"

The embedded sign-in functionality depends on the `App-Native Authentication` feature. This feature allows your app to authenticate users without redirecting them to the {{ product_name }} sign-in page.

To enable this feature, follow these steps:

- Navigate to {{ product_name }} Console
- Go to **Applications > Your App > Advanced**
- Enable **App-Native Authentication** by checking the checkbox.

!!! Info

    Read more about [App-Native Authentication]({{ base_path }}/guides/authentication/app-native-authentication/){:target="_blank"} to understand how it works.

## Set up the in-app sign-in form [//] SHOW_IF="data-quickstart=embedded"

First, create an app route for the sign-in page. Create a new file called `app/sign-in/page.tsx` and add the following code:

```javascript title="app/sign-in/page.tsx"
'use client'

import { SignIn } from '@asgardeo/nextjs';

export default function SignInPage() {
  return <SignIn />;
}
```

Then, update the `.env` file with the route for the sign-in page. Add the following line to your `.env` file:

```bash title=".env"
NEXT_PUBLIC_ASGARDEO_SIGN_IN_URL="/sign-in"
```

## Run the app [//] SHOW_IF="data-quickstart=redirect,data-quickstart=embedded"

To run the app, use the following command:

=== "npm"

    ```bash
    npm run dev
    ```
    
=== "yarn"

    ```bash
    yarn dev
    ```
    
=== "pnpm"

    ```bash
    pnpm dev
    ```

Visit your app's homepage at [http://localhost:3000](http://localhost:3000).

!!! Important

    You need to create a test user in {{ product_name }} by following this [guide]({{ base_path }}/guides/users/manage-users/#onboard-single-user){:target="_blank"} to tryout sign-in and sign-out features.

[//] STEPS_END
